import 'vite/modulepreload-polyfill';
import { createApp, type Component } from 'vue';

import VulnerabilityTimeSeries from './components/VulnerabilityTimeSeries.vue';

// Function to mount Vue components
function mountVueComponent(selector: string, component: Component, props: Record<string, unknown> = {}) {
  const elements = document.querySelectorAll(`[class*="${selector}"]`);

  elements.forEach((element) => {
    // Extract data attributes as props
    const elementProps = { ...props };

    // Convert data attributes to camelCase props
    for (const attr of element.attributes) {
      if (attr.name.startsWith('data-')) {
        const propName = attr.name
          .replace('data-', '')
          .replace(/-([a-z])/g, (_, letter) => letter.toUpperCase());

        // Convert specific props to correct types
        let value: unknown = attr.value;
        if (propName === 'defaultDays' && attr.value) {
          value = parseInt(attr.value, 10);
        } else if (propName === 'showProductFilter' && attr.value) {
          value = attr.value === 'true';
        }

        elementProps[propName] = value;
      }
    }

    const app = createApp(component, elementProps);
    app.mount(element);
  });
}

// Mount components when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  mountVueComponent('vc-vulnerability-timeseries', VulnerabilityTimeSeries);
});